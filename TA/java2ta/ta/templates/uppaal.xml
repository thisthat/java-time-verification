<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
{# NB the filter |e is for escaping purposes and is default in Jinja2; consider using automatic escaping #}
<nta>
	<declaration>{% if legend %}
{% for label,desc in legend %}// {{ label|e }}: {{ desc|e }}
{% endfor %}
{% endif %}
{% for chan in nta.broadcast_channels %}
    broadcast chan {{ chan }};
{% endfor %}
</declaration>
    {% for tat in nta.ta_templates %}
	<template>
		<name>{{ tat.name }}</name>
		<declaration>
        // legend for locations and predicates
        {% for l in tat.locations %}
        // {{ l.name|loc_name }} : {{ l.predicate }}
        {% endfor %}
        {% for curr_var in tat.variables %}
        {{ curr_var.type.name }} {{ curr_var.name|var_name }}{% if curr_var.value %} = {{ curr_var.value }}{% endif %};
        {% endfor %}    
        {% for curr_clock in tat.clock_variables %}
        clock {{ curr_clock.name|var_name }};
        {% endfor %}
        </declaration>
        {% for curr_loc in tat.locations %}
		<location id="{{ curr_loc.name|loc_name }}" x="{{ curr_loc|loc_x }}" y="{{ curr_loc|loc_y }}">
			<name>{{ curr_loc.name|loc_name }}</name>
            {% if curr_loc.invariant %}
            <label kind="invariant">{{ curr_loc.invariant|var_name|e }}</label>
            {% endif %}
            {% if curr_loc.is_committed %}
            <committed />
            {% elif curr_loc.is_urgent %}
            <urgent />
            {% endif %}
		</location>
        {% endfor %}
        {% if tat.initial_loc %}
		<init ref="{{ tat.initial_loc.name|loc_name }}"/>
        {% endif %}
        {% for curr_edge in tat.edges %}
		<transition>
            <!-- transition id: {{ loop.index }} -->
			<source ref="{{ curr_edge.source.name|loc_name }}"/>
			<target ref="{{ curr_edge.target.name|loc_name }}"/>
            {% if curr_edge.guard %}
			<label kind="guard">{{ curr_edge.guard|var_name|e }}</label>
            {% endif %}
            {% if curr_edge.reset %}
			<label kind="assignment">{% for r in curr_edge.reset %}{{ r|var_name|e }} := 0{% if not loop.last %},{% endif %}{% endfor %}</label>
            {% endif %}
            {% if curr_edge.synchronization %}
            <label kind="synchronisation">{{ curr_edge.synchronization|channel_name|e }}</label>
    
            {% endif %}
		</transition>
        {% endfor %}
	</template>
    {% endfor %}
	<system>
{% for ta in nta.tas %}
{{ ta.name }} = {{ ta.template.name }}();
{% endfor %}
system {% for ta in nta.tas %}{{ ta.name }}{% if not loop.last %},{% endif %}{% endfor %};
    </system>
	<queries>
	</queries>
</nta>
